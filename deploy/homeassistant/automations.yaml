- id: shed_viewer_heartbeat
  alias: Shed Viewer Heartbeat
  trigger:
    - platform: time_pattern
      seconds: "/30"
  condition:
    - condition: state
      entity_id: sensor.shed_ptz_mode
      state: "panorama"
  action:
    - service: mqtt.publish
      data:
        topic: shed/cmd/view_heartbeat
        payload: "1"

- id: auto_open_tuya
  alias: "Mở cửa Tuya khi có biển số hợp lệ"
  trigger:
    - platform: mqtt
      topic: "shed/trigger/open"
  action:
    - service: cover.open_cover
      target:
        entity_id: cover.garage_door # Cần đổi lại ID này nếu khác
    - service: notify.mobile_app
      data:
        message: "Mở cửa tự động (Biển số hợp lệ)"
      entity_id: sensor.shed_people_count
      to: "0"
      for: "00:05:00"
  condition:
    - condition: state
      entity_id: cover.cua_cuon_kho
      state: "open"
  action:
    - service: cover.close_cover
      target:
        entity_id: cover.cua_cuon_kho
    - service: persistent_notification.create
      data:
        title: "Cửa cuốn"
        message: "Cửa đã tự động đóng - Không có người 5 phút"

- id: notify_door_opened
  alias: "Thông báo khi cửa mở"
  trigger:
    - platform: state
      entity_id: cover.cua_cuon_kho
      to: "open"
  action:
    - service: persistent_notification.create
      data:
        title: "Cửa cuốn"
        message: "Cửa cuốn đã MỞ"

- id: notify_door_closed
  alias: "Thông báo khi cửa đóng"
  trigger:
    - platform: state
      entity_id: cover.cua_cuon_kho
      to: "closed"
  action:
    - service: persistent_notification.create
      data:
        title: "Cửa cuốn"
        message: "Cửa cuốn đã ĐÓNG"


- id: ptz_return_default_no_people_5m
  alias: "Về vị trí mặc định khi không có người 5 phút"
  trigger:
    - platform: numeric_state
      entity_id: sensor.shed_people_count
      below: 1
      for: "00:05:00"
  action:
    - service: button.press
      target:
        entity_id: button.shed_ptz_gate
    - service: persistent_notification.create
      data:
        title: "PTZ Auto Return"
        message: "Không có người 5 phút, camera đã về vị trí mặc định."
