go2rtc:
  streams:
    # Stream gốc (cho detect + record, không có filter)
    imou_2k:
      - "rtsp://admin:L2D47B99@10.115.215.241:554/cam/realmonitor?channel=1&subtype=0"
    # Stream đã "in" vạch đỏ (dùng cho live view trên HA/Frigate UI)
    imou_2k_overlay:
      # drawbox theo % chiều cao: y=ih*0.62, dày 6px, màu đỏ 85% đục
      - "ffmpeg:imou_2k#video=h264#hardware#drawbox=x=0:y=ih*0.62:w=iw:h=6:color=red@0.85:t=fill"

mqtt:
  host: mosquitto
  port: 1883
  topic_prefix: frigate

record:
  enabled: true
  retain:
    days: 0

cameras:
  imou_2k:
    ffmpeg:
      inputs:
        # Input 1: stream gốc cho detect + record (không có drawbox để AI không bị ảnh hưởng)
        - path: rtsp://127.0.0.1:8554/imou_2k
          roles:
            - record
            - detect
        # Input 2: stream đã "in" vạch đỏ - chỉ dùng cho live view
        - path: rtsp://127.0.0.1:8554/imou_2k_overlay
          roles:
            - live
    detect:
      width: 1280
      height: 720
      fps: 8
    objects:
      track:
        - person
        - car
        - truck
      filters:
        person:
          # Giảm nhận diện sai (áo/quần áo/vật thể) nhưng vẫn giữ được người thật
          threshold: 0.66
          min_score: 0.50
          min_area: 1400
          min_ratio: 0.30
          max_ratio: 1.20
        car:
          threshold: 0.60
          min_score: 0.45
        truck:
          threshold: 0.60
          min_score: 0.45
    motion:
      # Tune these if lighting changes cause false positives
      threshold: 35
      contour_area: 100
      improve_contrast: true
    zones:
      # Zone mỏng ~60px tại vạch đỏ (y=0.59–0.65 chiều cao 720px ≈ y424–y468)
      # Frigate dùng tọa độ tỉ lệ 0.0–1.0: x,y theo cặp clockwise
      door_line:
        coordinates: 0,0.59,1,0.59,1,0.65,0,0.65
        # Khi object vào zone này = đang tại vạch đỏ → fire event
        objects:
          - person
          - car
          - truck
      # Phía trong kho (bên dưới vạch)
      inside:
        coordinates: 0,0.65,1,0.65,1,1,0,1
        objects:
          - person
          - car
          - truck
      # Phía ngoài (bên trên vạch, hướng ra cổng)
      outside:
        coordinates: 0,0,1,0,1,0.59,0,0.59
        objects:
          - person
          - car
          - truck

# Record only on motion/events (no 24/7 recording)
# Adjust zones to limit detection/recording to the gate area.
