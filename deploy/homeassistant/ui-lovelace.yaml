title: Shed Dashboard
views:
  - title: Overview
    path: overview
    cards:
      - type: entities
        title: C·∫£nh b√°o camera
        show_header_toggle: false
        entities:
          - entity: binary_sensor.shed_camera_shift_motion
            name: Camera b·ªã quay l·ªách
          - entity: sensor.shed_camera_shift_status
            name: Tr·∫°ng th√°i camera
          - entity: sensor.shed_camera_shift_last_event
            name: L·∫ßn c·∫£nh b√°o g·∫ßn nh·∫•t

      - type: entities
        title: S·ªë l∆∞·ª£ng qua v·∫°ch ƒë·ªè (text)
        show_header_toggle: false
        entities:
          - entity: sensor.shed_people_count
            name: Ng∆∞·ªùi qua v·∫°ch ƒë·ªè
          - entity: sensor.shed_vehicle_count
            name: Xe qua v·∫°ch ƒë·ªè

      - type: markdown
        title: Quy t·∫Øc t·ª± ƒë·ªông
        content: |
          - N·∫øu kh√¥ng c√≥ ng∆∞·ªùi 5 ph√∫t, camera t·ª± v·ªÅ v·ªã tr√≠ m·∫∑c ƒë·ªãnh (g√≥c gi·ªØa/c·ªïng).
          - Nh√£n v√πng nh·∫≠n di·ªán: **Ng∆∞·ªùi = v√†ng**, **Xe = xanh**.
          - N√∫t nh·∫≠n di·ªán n√¢ng cao l√†m tr√™n Telegram, kh√¥ng thao t√°c tr√™n HA.

      - type: horizontal-stack
        cards:
          - type: conditional
            conditions:
              - condition: state
                entity: switch.shed_ocr_enabled
                state: "on"
            card:
              type: tile
              entity: switch.shed_ocr_enabled
              name: OCR Enabled
              tap_action:
                action: toggle
              state_content:
                - state
          - type: conditional
            conditions:
              - condition: state
                entity: switch.shed_ocr_enabled
                state: "off"
            card:
              type: tile
              entity: sensor.shed_ocr_countdown_display
              name: OCR Enabled
              tap_action:
                action: toggle
                toggle:
                  entity: switch.shed_ocr_enabled
              state_content:
                - state
          - type: tile
            entity: switch.shed_gate
            name: C·ªïng

      - type: entities
        title: OCR t·ª± b·∫≠t l·∫°i sau khi quay tay
        show_header_toggle: false
        entities:
          - type: attribute
            entity: switch.shed_ocr_enabled
            attribute: countdown_minutes
            name: ƒê·∫øm ng∆∞·ª£c b·∫≠t OCR (ph√∫t)
          - type: attribute
            entity: switch.shed_ocr_enabled
            attribute: countdown_text
            name: ƒê·∫øm ng∆∞·ª£c chi ti·∫øt

      - type: grid
        title: ƒêi·ªÅu khi·ªÉn h∆∞·ªõng quay camera
        square: false
        columns: 3
        cards:
          - type: button
            name: L√™n
            icon: mdi:arrow-up-bold
            show_state: false
            tap_action:
              action: call-service
              service: mqtt.publish
              data:
                topic: shed/cmd/ptz_operation
                payload: '{"operation":"0","duration":200}'
          - type: button
            name: To√†n c·∫£nh
            icon: mdi:panorama
            show_state: false
            tap_action:
              action: call-service
              service: mqtt.publish
              data:
                topic: shed/cmd/ptz_panorama
                payload: "1"
          - type: button
            name: Tr√°i
            icon: mdi:arrow-left-bold
            show_state: false
            tap_action:
              action: call-service
              service: mqtt.publish
              data:
                topic: shed/cmd/ptz_operation
                payload: '{"operation":"2","duration":200}'
          - type: button
            name: V·ªÅ v·ªã tr√≠ m·∫∑c ƒë·ªãnh
            icon: mdi:crosshairs-gps
            show_state: false
            tap_action:
              action: call-service
              service: mqtt.publish
              data:
                topic: shed/cmd/ptz_gate
                payload: "1"
          - type: button
            name: Ph·∫£i
            icon: mdi:arrow-right-bold
            show_state: false
            tap_action:
              action: call-service
              service: mqtt.publish
              data:
                topic: shed/cmd/ptz_operation
                payload: '{"operation":"3","duration":200}'
          - type: button
            name: Xu·ªëng
            icon: mdi:arrow-down-bold
            show_state: false
            tap_action:
              action: call-service
              service: mqtt.publish
              data:
                topic: shed/cmd/ptz_operation
                payload: '{"operation":"1","duration":200}'


      - type: horizontal-stack
        cards:
          - type: button
            name: Xem Frigate NVR
            icon: mdi:cctv
            tap_action:
              action: url
              url_path: http://127.0.0.1:5000
          - type: button
            name: Xem Frigate Events
            icon: mdi:history
            tap_action:
              action: url
              url_path: http://127.0.0.1:5000/review

      # ================================================
      # Camera card v·ªõi v·∫°ch ƒë·ªè ƒë√£ ‚Äúin‚Äù v√†o stream + zone m·ªèng hi·ªÉn th·ªã tr·ª±c ti·∫øp
      # ================================================
      - type: picture-elements
        title: "Camera C·ª≠a Cu·ªën (stream c√≥ v·∫°ch ƒë·ªè)"
        camera_image: camera.shed_ai_overlay
        camera_view: live
        elements:
          # --- Zone strip m·ªèng t·∫°i v·∫°ch (59%‚Äì65% chi·ªÅu cao) ---
          - type: custom:html-template-card  # fallback: d√πng custom-ui element n·∫øu c·∫ßn
            ignore_line_breaks: true
            content: ""
            style:
              position: absolute
              left: "0%"
              top: "59%"
              width: "100%"
              height: "6%"
              background: "rgba(255, 100, 0, 0.18)"
              border-top: "2px solid rgba(255,80,0,0.7)"
              border-bottom: "2px solid rgba(255,80,0,0.7)"
              pointer-events: none
              z-index: "10"

          # --- Label ‚ÄúV·∫°ch ƒë·ªè‚Äù t·∫°i v·ªã tr√≠ v·∫°ch ---
          - type: state-label
            entity: sensor.shed_people_count
            prefix: "üö∂ "
            suffix: " ng∆∞·ªùi"
            style:
              position: absolute
              left: "2%"
              top: "53%"
              color: white
              background: rgba(0,0,0,0.55)
              padding: "2px 8px"
              border-radius: "4px"
              font-size: "13px"
              font-weight: bold
              pointer-events: none

          - type: state-label
            entity: sensor.shed_vehicle_count
            prefix: "üöõ "
            suffix: " xe"
            style:
              position: absolute
              left: "2%"
              top: "67%"
              color: white
              background: rgba(0,0,0,0.55)
              padding: "2px 8px"
              border-radius: "4px"
              font-size: "13px"
              font-weight: bold
              pointer-events: none

          # --- N√£n label v√†o/ra g√≥c tr√™n ph·∫£i ---
          - type: state-icon
            entity: switch.shed_gate
            style:
              position: absolute
              right: "2%"
              top: "4%"
              color: "var(--state-switch-active-color)"

      - type: markdown
        title: L∆∞u √Ω camera
        content: |
          - **V·∫°ch ƒë·ªè** ƒë√£ ‚Äúin‚Äù th·∫≥ng v√†o stream (go2rtc `drawbox`) ‚Äî ai xem c≈©ng th·∫•y, k·ªÉ c·∫£ khi ghi l·∫°i.
          - **Zone m·ªèng cam** (hi·ªÉn th·ªã tr√™n HA) kh·ªõp zone `door_line` c·ªßa Frigate (59%‚Äì65%).
          - Ch·ªânh `top`/`height` ·ªü card tr√™n n·∫øu v·∫°ch ch∆∞a kh·ªõp ƒë√∫ng v·ªã tr√≠ c·ª≠a cu·ªën.
          - Stream URL c√≥ v·∫°ch ƒë·ªè: `rtsp://&lt;frigate_ip&gt;:8554/imou_2k_overlay`

